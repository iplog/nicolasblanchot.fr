/**
 * @license RequireJS domReady 2.0.0 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

/**
 * @license RequireJS text 2.0.0 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*!
 * iScroll v4.1.9 ~ Copyright (c) 2011 Matteo Spinelli, http://cubiq.org
 * Released under MIT license, http://cubiq.org/license
 */

/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */

define("domReady",[],function(){function h(a){var b;for(b=0;b<a.length;b++)a[b](c)}function i(){var a=d;b&&a.length&&(d=[],h(a))}function j(){b||(b=!0,g&&clearInterval(g),i())}function l(a){return b?a(c):d.push(a),l}var a=typeof window!="undefined"&&window.document,b=!a,c=a?document:null,d=[],e,f,g;if(a){if(document.addEventListener)document.addEventListener("DOMContentLoaded",j,!1),window.addEventListener("load",j,!1);else if(window.attachEvent){window.attachEvent("onload",j),f=document.createElement("div");try{e=window.frameElement===null}catch(k){}f.doScroll&&e&&window.external&&(g=setInterval(function(){try{f.doScroll(),j()}catch(a){}},30))}(document.readyState==="complete"||document.readyState==="interactive")&&j()}return l.version="2.0.0",l.load=function(a,b,c,d){d.isBuild?c(null):l(c)},l}),define("text",["module"],function(a){var b=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],c=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,d=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,e=typeof location!="undefined"&&location.href,f=e&&location.protocol&&location.protocol.replace(/\:/,""),g=e&&location.hostname,h=e&&(location.port||undefined),i=[],j=a.config(),k,l;return k={version:"2.0.0",strip:function(a){if(a){a=a.replace(c,"");var b=a.match(d);b&&(a=b[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var a,c,d;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(c=0;c<3;c++){d=b[c];try{a=new ActiveXObject(d)}catch(e){}if(a){b=[d];break}}return a},parseName:function(a){var b=!1,c=a.indexOf("."),d=a.substring(0,c),e=a.substring(c+1,a.length);return c=e.indexOf("!"),c!==-1&&(b=e.substring(c+1,e.length),b=b==="strip",e=e.substring(0,c)),{moduleName:d,ext:e,strip:b}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,b,c,d){var e=k.xdRegExp.exec(a),f,g,h;return e?(f=e[2],g=e[3],g=g.split(":"),h=g[1],g=g[0],(!f||f===b)&&(!g||g===c)&&(!h&&!g||h===d)):!0},finishLoad:function(a,b,c,d){c=b?k.strip(c):c,j.isBuild&&(i[a]=c),d(c)},load:function(a,b,c,d){if(d.isBuild&&!d.inlineText){c();return}j.isBuild=d.isBuild;var i=k.parseName(a),l=i.moduleName+"."+i.ext,m=b.toUrl(l),n=j.useXhr||k.useXhr;!e||n(m,f,g,h)?k.get(m,function(b){k.finishLoad(a,i.strip,b,c)},function(a){c.error&&c.error(a)}):b([l],function(a){k.finishLoad(i.moduleName+"."+i.ext,i.strip,a,c)})},write:function(a,b,c,d){if(i.hasOwnProperty(b)){var e=k.jsEscape(i[b]);c.asModule(a+"!"+b,"define(function () { return '"+e+"';});\n")}},writeFile:function(a,b,c,d,e){var f=k.parseName(b),g=f.moduleName+"."+f.ext,h=c.toUrl(f.moduleName+"."+f.ext)+".js";k.load(g,c,function(b){var c=function(a){return d(h,a)};c.asModule=function(a,b){return d.asModule(a,h,b)},k.write(a,g,c,e)},e)}},typeof process!="undefined"&&process.versions&&!!process.versions.node?(l=require.nodeRequire("fs"),k.get=function(a,b){var c=l.readFileSync(a,"utf8");c.indexOf("﻿")===0&&(c=c.substring(1)),b(c)}):k.createXhr()?k.get=function(a,b,c){var d=k.createXhr();d.open("GET",a,!0),j.onXhr&&j.onXhr(d,a),d.onreadystatechange=function(e){var f,g;d.readyState===4&&(f=d.status,f>399&&f<600?(g=new Error(a+" HTTP status: "+f),g.xhr=d,c(g)):b(d.responseText))},d.send(null)}:typeof Packages!="undefined"&&(k.get=function(a,b){var c="utf-8",d=new java.io.File(a),e=java.lang.System.getProperty("line.separator"),f=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(d),c)),g,h,i="";try{g=new java.lang.StringBuffer,h=f.readLine(),h&&h.length()&&h.charAt(0)===65279&&(h=h.substring(1)),g.append(h);while((h=f.readLine())!==null)g.append(e),g.append(h);i=String(g.toString())}finally{f.close()}b(i)}),k}),define("text!templates/LoginView.html",[],function(){return'<div id="splashScreenContener" >\n    <div id="fbButton" align="center"></div>\n</div>\n'}),define("models/user",[],function(){return Backbone.Model.extend({defaults:{lat:48.858842,lng:2.373219},getGeo:function(){return navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(a){hckApp.user.geo={lat:a.coords.latitude,lng:a.coords.longitude}}),hckApp.user.geo},getStartGeo:function(){return navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(a){hckApp.user.startGeo={lat:a.coords.latitude,lng:a.coords.longitude}}),hckApp.user.startGeo},getScore:function(){console.assert(!1,"NOT IMPLEMENTED")},addScore:function(){console.assert(!1,"NOT IMPLEMENTED")}})}),define("views/LoginView",["text!templates/LoginView.html","models/user"],function(a,b){var c=Backbone.View.extend({tagName:"div",id:"login",className:"viewWrapper",events:{"click #fbButton":"connect"},template:a,initialize:function(){_.bindAll(this,"render","connect")},render:function(){return $(this.el).html(Mustache.to_html(this.template)),this},connect:function(a){a.preventDefault(),this.connectToFacebook()},connectToFacebook:function(){if(!!hckApp.config.webapp)return localStorage.userMail="valentin@civiliz.fr",hckApp.user=new b({usermMail:"valentin@civiliz.fr"}),hckApp.router.navigate("callToAction",!0);var a=function(a){if(!a.error)return console.log(a),localStorage.userMail=a.email,hckApp.user=new b({usermMail:a.email}),hckApp.router.navigate("callToAction",!0);console.log(JSON.stringify(a.error))},c={success:function(b){console.log(b),FB.api("/me",{fields:"id, email"},a)},error:function(a){console.log(a)}};hckApp.fbHdl.login(c)}});return c}),define("text!templates/CallToActionView.html",[],function(){return'<div class="navigationBar">\n  <div class="profileButton"></div>\n</div>\n<div id="catchItLabel">J’ai besoin d’attraper un train !</div>\n<div id="catchItButton"></div>\n<div id="moodLabel">Je consulte l’humeur de ma ligne.</div>\n<div id="moodButton"></div>\n\n'}),define("views/CallToActionView",["text!templates/CallToActionView.html"],function(a){var b=Backbone.View.extend({tagName:"div",id:"callToAction",className:"viewWrapper",events:{"click #catchItButton":"catchItButtonEvt","click #moodButton":"moodButtonEvt"},template:a,initialize:function(){_.bindAll(this,"render")},render:function(){return $(this.el).html(Mustache.to_html(this.template)),this},catchItButtonEvt:function(a){return a.preventDefault(),hckApp.router.navigate("selectJourney",!0)},moodButtonEvt:function(a){return a.preventDefault(),hckApp.router.navigate("moodGame",!0)}});return b}),define("text!templates/SelectJourneyView.html",[],function(){return'<div class="navigationBar">\n  <div class="backButton"></div>\n  <div class="profileButton"></div>\n</div>\n<div class="wrapper">\n  <div class="scrollable">\n    <div id="selectJourneyLabel"> Choisis ta destination puis l\'horaire de ton train</div>\n    <ul class="selectJourneyList"></ul>\n  </div>\n</div>\n\n'}),define("text!templates/StopView.html",[],function(){return'<div class="stopList">\n  <div class="stopImage"></div>\n  <div class="stopInfo">\n    {{gare}} -> {{destination}}\n  </div>\n  <!-- put  formated date here fromatedDateView-->\n  <ul id="list_{{cid}}" class="trainTimes">\n  </ul>\n\n</div>\n'}),define("text!templates/FormatedDateView.html",[],function(){return"{{date}}\n"}),define("views/FormatedDateView",["text!templates/FormatedDateView.html"],function(a){var b=Backbone.View.extend({tagName:"li",className:"trainInfo",events:{click:"select"},template:a,initialize:function(){_.bindAll(this,"render","select")},render:function(){var a=this.model.attributes;return this.$el.html(Mustache.to_html(this.template,a)),this},select:function(a){return a.preventDefault(),hckApp.router.navigate("countDown/"+this.model.attributes.cid+"/"+this.model.attributes.index,!0)}});return b}),define("models/FormatedDate",[],function(){return Backbone.Model.extend()}),define("views/StopView",["text!templates/StopView.html","views/FormatedDateView","models/FormatedDate"],function(a,b,c){var d=Backbone.View.extend({tagName:"li",events:{},template:a,initialize:function(){_.bindAll(this,"render","formatDate","dateFormater")},render:function(){var a=this.model.getTrainInfo();a.cid=this.cid;var d=a.horaires;a.horaires=[d,d,d],this.$el.html(Mustache.to_html(this.template,a)),this.formatedDate=[],this.formatDate(a.horaires);var e=this.$el.find("#list_"+this.cid);for(var f=0,g=this.formatedDate.length;f<g;++f){var h={cid:this.model.cid,index:f,date:this.formatedDate[f]},i=new c(h),j=new b({model:i});e.append(j.render().el)}return this},formatDate:function(a){_.each(a,this.dateFormater)},dateFormater:function(a){var b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate(),e=a.getHours(),f=a.getMinutes(),g=a.getSeconds(),h="le "+d+"/"+c+"/"+b+" à "+e+":"+f+":"+g;this.formatedDate.push(h)}});return d}),define("models/arret",[],function(){return Backbone.Model.extend({trains:[],_requested:!1,_request:function(a,b){var c=this;wsh.exec("sncf departs 87"+a,function(a){a.cmd!=="render"&&console.assert(!1,"ERREUR"),c.trains=a.data[0].passages.train,b(c)})},getGare:function(){return this.get("gare")},prepareTrainInfo:function(a){this._requested?a(this):(this._request(this.get("uic"),a),this._requested=!0)},getTrainInfo:function(){var a=this.attributes,b=this.trains[0].date.split(" "),c=b[0].split("/"),d=b[1].split(":");return a.horaires=new Date(c[2],~~c[1]-1,c[0],d[0],d[1],0,0),a.destination=this.trains[0].term,a},getDistanceParcours:function(){var a=this,b=this.getCoords();$.ajaxJSONP({url:"http://open.mapquestapi.com/directions/v1/route?from="+hckApp.user.get("lng")+","+hckApp.user.get("lat")+"&to="+b.lat+","+b.lng+"&unit=k&narrativeType=none&doReverseGeocode=false&routeType=pedestrian&callback=?",success:function(b){b.route.distance?a.set("distanceParcours",b.route.distance):a.set("distanceParcours","error")}})},getDistance:function(){return this.getOrthodromicDistance(parseFloat(hckApp.user.get("lat")),parseFloat(hckApp.user.get("lng")),parseFloat(this.getCoords().lat),parseFloat(this.getCoords().lng))},getAffluence:function(){console.assert(!1,"NOT IMPLEMENTED")},getTips:function(){return["Ceci est un tips","Ceci est un 2e tips"]},getInfoGenerales:function(){var a=["Ceci est une info générale","Ceci est une autre info générale"];for(this.getTips()in tips)a.push(tips);return a},getCoords:function(){return{lat:this.get("latitude"),lng:this.get("longitude")}},degToRad:function(a){return a/180*Math.PI},getOrthodromicDistance:function(a,b,c,d){var e=6366;a=this.degToRad(a),b=this.degToRad(b),c=this.degToRad(c),d=this.degToRad(d);var f=Math.acos(Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos(b-d));return f*e}})}),define("views/SelectJourneyView",["text!templates/SelectJourneyView.html","views/StopView","models/arret"],function(a,b,c){var d=Backbone.View.extend({tagName:"div",id:"selectJourneyView",className:"viewWrapper",events:{"click .backButton":"back"},template:a,initialize:function(){console.log("selectJourneyView"),_.bindAll(this,"render")},render:function(){this.$el.html(Mustache.to_html(this.template));var a=this.collection.getArretList();console.log(a.length);var c=this.$el.find("ul");return a.each(function(a){a.prepareTrainInfo(function(a){var d=new b({model:a});c.append(d.render().el),$.refreshScroll()})}),this},back:function(a){return history.back(),!1}});return d}),define("text!templates/MoodGameView.html",[],function(){return'<div class="navigationBar">\n  <div class="backButton"></div>\n  <div class="profileButton"></div>\n</div>\nMood Game\n<div id="civilizChildBrowser">civ</div>\n'}),define("views/MoodGameView",["text!templates/MoodGameView.html"],function(a){var b=Backbone.View.extend({tagName:"div",id:"moodGameView",className:"viewWrapper",events:{"click .backButton":"back","click #civilizChildBrowser":"giveAFeedback"},template:a,initialize:function(){_.bindAll(this,"render")},render:function(){return $(this.el).html(Mustache.to_html(this.template)),this},back:function(a){return a.preventDefault(),hckApp.router.navigate("callToAction",!0),!1},giveAFeedback:function(a){a.preventDefault(),window.plugins.childBrowser?window.plugins.childBrowser.showWebPage("http://m.civiliz.fr/rerdligner_sncf"):alert("only available in native app")}});return b}),define("text!templates/SuccessView.html",[],function(){return'<div class="navigationBar">\n  <div class="profileButton"></div>\n</div>\n\nLa Win BRO !\n\n<div id="meteo">meteo</div>\n\n'}),define("views/SuccessView",["text!templates/SuccessView.html"],function(a){var b=Backbone.View.extend({tagName:"div",id:"success",className:"viewWrapper",events:{"click #meteo":"meteo"},template:a,initialize:function(){_.bindAll(this,"render"),console.log(this.model)},render:function(){return $(this.el).html(Mustache.to_html(this.template)),this},meteo:function(a){return a.preventDefault(),hckApp.router.navigate("moodGame",!0)}});return b}),define("text!templates/FailView.html",[],function(){return'<div class="navigationBar">\n</div>\nLa loose BRO !\n\n<div id="nextTrains">Next trains</div>\n'}),define("views/FailView",["text!templates/FailView.html"],function(a){var b=Backbone.View.extend({tagName:"div",id:"fail",className:"viewWrapper",events:{"click #nextTrains":"nextTrains"},template:a,initialize:function(){_.bindAll(this,"render"),console.log(this.model)},render:function(){return $(this.el).html(Mustache.to_html(this.template)),this},nextTrains:function(a){return a.preventDefault(),hckApp.router.navigate("callToAction",!0)}});return b}),define("collections/arrets_data",[],function(){return[{uic:"545269",gare:"Ablon",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.72511",longitude:"2.41896"},{uic:"381657",gare:"Achères Ville",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.96934",longitude:"2.07779"},{uic:"545467",gare:"Arpajon",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.58614",longitude:"2.24049"},{uic:"381137",gare:"Asnières sur Seine",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.90530",longitude:"2.28378"},{uic:"545251",gare:"Athis Mons",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.71235",longitude:"2.40310"},{uic:"545657",gare:"Auneau",type:"Gare Ferroviaire de Voyageurs",region:"Centre",latitude:"48.44545",longitude:"1.77976"},{uic:"543207",gare:"Avenue du Président Kennedy",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.85357",longitude:"2.27964"},{uic:"381038",gare:"Avenue Foch",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.87140",longitude:"2.27568"},{uic:"381046",gare:"Avenue Henri-Martin",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.86494",longitude:"2.27211"},{uic:"382002",gare:"Bécon les Bruyères",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.90583",longitude:"2.26831"},{uic:"328328",gare:"Bibliothèque François Mitterrand",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.82874",longitude:"2.37794"},{uic:"393546",gare:"Bièvres",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.75124",longitude:"2.21556"},{uic:"545731",gare:"Bonneval",type:"Gare Ferroviaire de Voyageurs",region:"Centre",latitude:"48.18630",longitude:"1.38613"},{uic:"382440",gare:"Bougival",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.85402",longitude:"2.13205"},{uic:"543181",gare:"Boulainvilliers",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.85716",longitude:"2.27484"},{uic:"393322",gare:"Boulevard Victor",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.84105",longitude:"2.27185"},{uic:"545178",gare:"Bouray",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.53325",longitude:"2.29031"},{uic:"545194",gare:"Brétigny",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.60624",longitude:"2.30193"},{uic:"545483",gare:"Breuillet - Bruyères le Châtel",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.57780",longitude:"2.19283"},{uic:"545491",gare:"Breuillet Village",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.56481",longitude:"2.17132"},{uic:"382655",gare:"Cergy le Haut",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"49.04766",longitude:"2.01078"},{uic:"381905",gare:"Cergy Préfecture",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"49.03665",longitude:"2.07965"},{uic:"382499",gare:"Cergy Saint-Christophe",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"49.04985",longitude:"2.03348"},{uic:"276063",gare:"Cernay (Val-d'Oise)",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.98528",longitude:"2.25702"},{uic:"545152",gare:"Chamarande",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.51466",longitude:"2.21607"},{uic:"393058",gare:"Champ de Mars Tour Eiffel",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.85869",longitude:"2.29204"},{uic:"545756",gare:"Châteaudun",type:"Gare Ferroviaire de Voyageurs",region:"Centre",latitude:"48.07353",longitude:"1.33843"},{uic:"382333",gare:"Chaville-Rive-Droite",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.81183",longitude:"2.18764"},{uic:"393173",gare:"Chaville-Vélizy",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.79983",longitude:"2.18318"},{uic:"546317",gare:"Chemin-d'Antony",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.74805",longitude:"2.31326"},{uic:"393637",gare:"Chilly-Mazarin",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.69997",longitude:"2.30952"},{uic:"545285",gare:"Choisy le Roi",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.76400",longitude:"2.41118"},{uic:"381129",gare:"Clichy-Levallois",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.89771",longitude:"2.29727"},{uic:"382200",gare:"Courbevoie",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.89786",longitude:"2.24778"},{uic:"545525",gare:"Dourdan",adresse_postale:"Avenue du Docteur Jules Bals 91410 Dourdan",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.53354",longitude:"2.01016"},{uic:"540179",gare:"Dourdan la Forêt",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.53556",longitude:"1.99694"},{uic:"545475",gare:"Égly",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.58241",longitude:"2.22221"},{uic:"545228",gare:"Épinay sur Orge",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.66934",longitude:"2.33224"},{uic:"271148",gare:"Épinay sur Seine",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.95408",longitude:"2.30237"},{uic:"276055",gare:"Ermont-Eaubonne",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.98054",longitude:"2.27276"},{uic:"545137",gare:"Étampes",adresse_postale:"Place du Général Leclerc 91150 Etampes",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.43686",longitude:"2.15900"},{uic:"545145",gare:"Étréchy",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.49364",longitude:"2.19445"},{uic:"276071",gare:"Franconville-Plessis-Bouchard",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.99356",longitude:"2.23499"},{uic:"382259",gare:"Garches-Marnes la Coquette",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.83798",longitude:"2.18668"},{uic:"271205",gare:"Gennevilliers",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.93339",longitude:"2.30749"},{uic:"393645",gare:"Gravigny-Balizy",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.68623",longitude:"2.31760"},{uic:"386409",gare:"Houilles-Carrières sur Seine",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.92059",longitude:"2.18474"},{uic:"393561",gare:"Igny",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.73980",longitude:"2.23107"},{uic:"393033",gare:"Invalides",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.86296",longitude:"2.31156"},{uic:"393074",gare:"Issy",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.82074",longitude:"2.26085"},{uic:"393306",gare:"Issy Val de Seine",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.83112",longitude:"2.26463"},{uic:"545301",gare:"Ivry sur Seine",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.81419",longitude:"2.39168"},{uic:"393066",gare:"Javel",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.84815",longitude:"2.27930"},{uic:"393512",gare:"Jouy en Josas",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.76454",longitude:"2.16817"},{uic:"382432",gare:"La Celle Saint-Cloud",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.84303",longitude:"2.13767"},{uic:"382218",gare:"La Défense",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.89311",longitude:"2.23789"},{uic:"386003",gare:"La Garenne-Colombes",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.90983",longitude:"2.23904"},{uic:"545459",gare:"La Norville Saint-Germain les Arpajon",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.59185",longitude:"2.26738"},{uic:"545160",gare:"Lardy",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.52079",longitude:"2.25518"},{uic:"382366",gare:"Le Val-d'Or",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.85699",longitude:"2.21652"},{uic:"492108",gare:"Les Ardoines",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.78426",longitude:"2.40925"},{uic:"272146",gare:"Les Grésillons",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.91886",longitude:"2.31477"},{uic:"546226",gare:"Les Saules",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.74453",longitude:"2.41709"},{uic:"386300",gare:"Les Vallées",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.91365",longitude:"2.25721"},{uic:"382473",gare:"L'Étang la Ville",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.86855",longitude:"2.07761"},{uic:"393611",gare:"Longjumeau",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.70193",longitude:"2.29743"},{uic:"382457",gare:"Louveciennes",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.86124",longitude:"2.12272"},{uic:"386425",gare:"Maisons-Laffitte",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.94595",longitude:"2.14419"},{uic:"382812",gare:"Mareil-Marly",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.88078",longitude:"2.07926"},{uic:"382465",gare:"Marly le Roi",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.87160",longitude:"2.09617"},{uic:"545186",gare:"Marolles en Hurepoix",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.56534",longitude:"2.29089"},{uic:"393579",gare:"Massy-Palaiseau-Grande-Ceinture",adresse_postale:"Avenue Carnot 91300 Massy",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.72412",longitude:"2.25594"},{uic:"383281",gare:"Massy-Verrières",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.73529",longitude:"2.27454"},{uic:"393082",gare:"Meudon-Val-Fleury",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.80845",longitude:"2.24172"},{uic:"276089",gare:"Montigny-Beauchamp",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"49.00778",longitude:"2.19682"},{uic:"382879",gare:"Montreuil",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.80624",longitude:"2.15220"},{uic:"547307",gare:"Musée-d'Orsay",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.86004",longitude:"2.32860"},{uic:"386318",gare:"Nanterre-Université",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.90151",longitude:"2.21517"},{uic:"381020",gare:"Neuilly-Porte-Maillot",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.87788",longitude:"2.28466"},{uic:"334482",gare:"Neuville-Université",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"49.01344",longitude:"2.07847"},{uic:"393876",gare:"Noisy le Roi",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.84149",longitude:"2.06163"},{uic:"546200",gare:"Orly-Ville",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.74284",longitude:"2.40186"},{uic:"547026",gare:"Paris Austerlitz souterrain",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.84049",longitude:"2.36702"},{uic:"384008",gare:"Paris Saint-Lazare",adresse_postale:"13, Rue d'Amsterdam 75008 PARIS",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.87645",longitude:"2.32400"},{uic:"381012",gare:"Péreire-Levallois",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.88518",longitude:"2.29806"},{uic:"393504",gare:"Petit-Jouy-Les Loges",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.76833",longitude:"2.14765"},{uic:"393652",gare:"Petit-Vaux",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.67738",longitude:"2.33085"},{uic:"276097",gare:"Pierrelaye",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"49.01928",longitude:"2.15403"},{uic:"381111",gare:"Pont-Cardinet",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.88759",longitude:"2.31439"},{uic:"393041",gare:"Pont-de-l'Alma",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.86281",longitude:"2.30306"},{uic:"546192",gare:"Pont-de-Rungis-Aéroport-d'Orly",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.74754",longitude:"2.37138"},{uic:"276139",gare:"Pontoise",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"49.04673",longitude:"2.09592"},{uic:"393165",gare:"Porchefontaine",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.79651",longitude:"2.14997"},{uic:"111278",gare:"Porte-de-Clichy",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.89358",longitude:"2.31165"},{uic:"382382",gare:"Puteaux",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.88364",longitude:"2.23391"},{uic:"546291",gare:"Rungis la Fraternelle",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.74056",longitude:"2.35241"},{uic:"545210",gare:"Sainte-Geneviève-des-Bois",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.65304",longitude:"2.31326"},{uic:"386417",gare:"Sartrouville",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.93743",longitude:"2.15742"},{uic:"545236",gare:"Savigny sur Orge",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.67592",longitude:"2.35178"},{uic:"545517",gare:"Sermaise",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.53550",longitude:"2.06882"},{uic:"382341",gare:"Sèvres-Ville-d'Avray",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.82738",longitude:"2.20095"},{uic:"545509",gare:"St-Chéron",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.55095",longitude:"2.12530"},{uic:"382358",gare:"St-Cloud",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.84523",longitude:"2.21694"},{uic:"393223",gare:"St-Cyr",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.79881",longitude:"2.07326"},{uic:"366922",gare:"St-Germain-Bel-air",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.89455",longitude:"2.07008"},{uic:"382804",gare:"St-Germain-Grande-Ceinture",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.90360",longitude:"2.07310"},{uic:"276170",gare:"St-Gratien",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.96381",longitude:"2.28538"},{uic:"545350",gare:"St-Martin-d'Étampes",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.42768",longitude:"2.14516"},{uic:"545202",gare:"St-Michel sur Orge",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.63535",longitude:"2.30690"},{uic:"547315",gare:"St-Michel-Notre-Dame",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.85312",longitude:"2.34708"},{uic:"382481",gare:"St-Nom la Bretêche-Forêt-de-Marly",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.86663",longitude:"2.05073"},{uic:"271247",gare:"St-Ouen",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.90432",longitude:"2.32018"},{uic:"276105",gare:"St-Ouen-l'Aumône",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"49.04539",longitude:"2.10767"},{uic:"337980",gare:"St-Ouen-l'Aumône-Liesse",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"49.03384",longitude:"2.12840"},{uic:"393843",gare:"St-Quentin en Yvelines",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.78712",longitude:"2.04387"},{uic:"382374",gare:"Suresnes-Mont-Valérien",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.87150",longitude:"2.22103"},{uic:"393538",gare:"Vauboyen",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.75928",longitude:"2.19193"},{uic:"382267",gare:"Vaucresson",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.83669",longitude:"2.15242"},{uic:"393009",gare:"Versailles-Chantiers",adresse_postale:"4, rue de l'Abbé Rousseau 78000 Versailles",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.79545",longitude:"2.13606"},{uic:"382861",gare:"Versailles-Rive-Droite",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.80960",longitude:"2.13570"},{uic:"393157",gare:"Versailles-Rive-Gauche",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.80002",longitude:"2.12991"},{uic:"545277",gare:"Villeneuve le Roi",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.73958",longitude:"2.42641"},{uic:"382887",gare:"Viroflay-Rive-Droite",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.80549",longitude:"2.16848"},{uic:"393215",gare:"Viroflay-Rive-Gauche",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.80069",longitude:"2.17075"},{uic:"545293",gare:"Vitry sur Seine",type:"Gare Ferroviaire de Voyageurs",region:"Ile de France",latitude:"48.80085",longitude:"2.40235"}]}),define("collections/arrets",["models/arret","collections/arrets_data"],function(a,b){return Backbone.Collection.prototype.getArretList=function(){var b=this.filter(function(a){return a.getDistance()<50}),c=new Backbone.Collection(b,{model:a});return c.comparator=function(a){return a.getDistance()},c.sort(),new Backbone.Collection(c.first(4),{model:a})},new Backbone.Collection(b,{model:a})}),define("text!templates/CountDownView.html",[],function(){return'<div class="navigationBar">\n  <div class="backButton"></div>\n</div>\n\n<div id="wrapper"><div id="flip-counter" class="flip-counter"></div></div>\n\n<div id="map"></div>\n\n<div id="go">GOOOO</div>\n<div id="caught">YES</div>\n<div id="fail">NOOOO</div>\n\n'}),define("text!templates/MapView.html",[],function(){return'<div id="innerMap" style="width:300px; height:150px;"></div>'}),define("views/MapView",["text!templates/MapView.html"],function(a){var b=Backbone.View.extend({tagName:"div",id:"map",events:{},template:a,initialize:function(){_.bindAll(this,"render")},render:function(){$(this.el).html(Mustache.to_html(this.template));var a=(parseFloat(this.model.getCoords().lat)+hckApp.user.get("lat"))/2,b=(parseFloat(this.model.getCoords().lng)+hckApp.user.get("lng"))/2,c={elt:this.$el.find("#innerMap").get(0),zoom:13,latLng:{lat:a,lng:b},mtype:"osm",zoomOnDoubleClick:!1},d=this,e=new MQA.Poi({lat:parseFloat(this.model.getCoords().lat),lng:parseFloat(this.model.getCoords().lng)}),f=new MQA.Poi({lat:hckApp.user.get("lat"),lng:hckApp.user.get("lng")});return setTimeout(function(){var a=new MQA.TileMap(c);a.setDraggable(!1);var b=new MQA.ShapeCollection;b.add(e),b.add(f),a.addShapeCollection(b),a.bestFit()},500),this}});return b}),define("views/CountDownView",["text!templates/CountDownView.html","views/MapView"],function(a,b){var c=Backbone.View.extend({tagName:"div",id:"countDown",className:"viewWrapper",events:{"click .backButton":"back","click #caught":"caught","click #fail":"fail","click #go":"go"},template:a,initialize:function(){_.bindAll(this,"render","go","caught","fail")},render:function(){var a=new b({model:this.model});$(this.el).html(Mustache.to_html(this.template)).find("#map").append(a.render().el).hide();var c=this;return setTimeout(function(){c.diplayCountdown(!0)},0),this.$el.find("#caught").hide(),this.$el.find("#fail").hide(),this},diplayCountdown:function(a){var b=this.model.get("horaires")[this.options.index];console.log(b);var c=b-new Date;c=~~(c/100);var d;a?d={value:c,inc:100,pace:1e4,auto:!0,endCallback:this.yourealoser}:d={value:c,inc:1,pace:100,auto:!0,endCallback:this.yourealoser},this.myCounter&&(this.myCounter.stop(),$("#flip-counter").children().remove()),this.myCounter=new flipCounter("flip-counter",d)},back:function(a){return a.preventDefault(),this.$el.find(".backButton").addClass("inactive")||(this.myCounter.stop(),history.back()),!1},caught:function(a){return a.preventDefault(),this.myCounter.stop(),hckApp.router.navigate("success",!0)},fail:function(a){return a.preventDefault(),this.myCounter.stop(),hckApp.router.navigate("fail",!0)},go:function(a){a.preventDefault(),this.diplayCountdown(!1),this.$el.find("#go").hide(),this.$el.find(".backButton").addClass("inactive"),this.$el.find("#map").show(),this.$el.find("#caught").show(),this.$el.find("#fail").show()},yourealoser:function(){hckApp.Tools.alert("You lose",function(){hckApp.router.navigate("fail",!0)},"Sorry...","Ok")}});return c}),define("routers/application_router",["views/LoginView","views/CallToActionView","views/SelectJourneyView","views/MoodGameView","views/SuccessView","views/FailView","collections/arrets","views/CountDownView"],function(a,b,c,d,e,f,g,h){var i=Backbone.Router.extend({routes:{"":"login",callToAction:"callToAction",selectJourney:"selectJourney",moodGame:"moodGame","countDown/:cid/:id":"countDown",success:"success",fail:"fail"},login:function(){return hckApp.loginView||(hckApp.loginView=new a),$.insertContent($(hckApp.loginView.render().el),{direction:0})},callToAction:function(){return hckApp.callToActionView||(hckApp.callToActionView=new b),$.insertContent($(hckApp.callToActionView.render().el),{direction:1})},selectJourney:function(){return hckApp.stops=g,hckApp.selectJourneyView||(hckApp.selectJourneyView=new c({collection:g})),$.insertContent($(hckApp.selectJourneyView.render().el),{direction:1})},moodGame:function(){return hckApp.moodGameView||(hckApp.moodGameView=new d),$.insertContent($(hckApp.moodGameView.render().el),{direction:1})},countDown:function(a,b){if(!hckApp.stops)return hckApp.router.navigate("selectJourney",!0);console.log(hckApp.stops);var c=hckApp.stops.getByCid(a);return hckApp.countDownView=new h({model:c,index:b}),$.insertContent($(hckApp.countDownView.render().el),{direction:1})},success:function(){return hckApp.successView||(hckApp.successView=new e),$.insertContent($(hckApp.successView.render().el),{direction:1})},fail:function(){return hckApp.failView||(hckApp.failView=new f),$.insertContent($(hckApp.failView.render().el),{direction:1})}});return i}),define("utils/FacebookHandler",[],function(){var a=function(){this.nonAppFriendIDs=[],this.appFriendIDs=[],this.friendIDs=[],this.friendsInfo=[]};return a.prototype.postFeed=function(a,b){a.actions=[{name:"Get Started",link:"http://www.civiliz.fr"}];var c=function(){this.onSuccess(),b?this.callNonUIMethod("/me/feed","post",a,function(){console.log("rating published on fb")}):(a.method="feed",this.callUIMethod(a))};this.getLoginStatus({success:$.proxy(c,this),error:this.onError},!0)},a.prototype.callUIMethod=function(a){FB.ui(a,function(a){console.log("publishStory UI response: ",a)})},a.prototype.callNonUIMethod=function(a,b,c,d){FB.api(a,b,c,d)},a.prototype.callApiMethod=function(a,b){FB.api(a,b)},a.prototype.login=function(a){function b(b){b.status==="connected"&&a&&a.success&&a.success(b),b.status!=="connected"&&a&&a.error&&a.error()}FB.login($.proxy(b,this),{scope:"email"})},a.prototype.getLoginStatus=function(a,b){function c(c){c.status==="connected"&&a&&a.success&&a.success(c),c.status!=="connected"&&(a&&a.error&&!b&&a.error(),b&&this.login(a))}FB.getLoginStatus($.proxy(c,this))},a.prototype.onSuccess=function(){try{civ.userMdl.hasConnectedToFbWeb()}catch(a){console.log(a.message)}},a.prototype.onError=function(){lib.alert("facebook_connection_error",null,"facebook_connection_error_title","facebook_connection_error_button_label",!0)},a.prototype.fetchData=function(a){this.nonAppFriendIDs=[],this.appFriendIDs=[],this.friendIDs=[],this.friendsInfo=[];var b=function(a){this.appFriendIDs=a,FB.api("/me/friends",{fields:"id, name, picture"},$.proxy(c,this))},c=function(b){var c=b.data;for(var d=0,e=c.length;d<e;++d){var f=c[d],g=1;this.friendIDs[d]=f.id,this.friendsInfo[d]=f;for(var h=0,i=this.appFriendIDs.length;h<i;++h)this.appFriendIDs[h]==f.id&&(g=-1);g==1&&this.nonAppFriendIDs.push(f.id)}typeof a=="function"&&a()};FB.api({method:"friends.getAppUsers"},$.proxy(b,this))},a.prototype.formatRatingFeed=function(a){var b="",c="",d="";a.ratingComment!==""&&(b='"'+a.ratingComment+'"'),c=civ.i18nSrv.getTranslation("facebook_status_post_place"),c=lib.sprintf(c,a.placeName),d=civ.i18nSrv.getTranslation("facebook_status_post_statut"),d=lib.sprintf(d,a.userStatut,a.userPoints);var e={picture:a.userStatutAvatar,link:civ.civilizWebsiteStatusPage,name:b+" "+c+" "+d,caption:civ.civilizWebsiteCaption,description:civ.i18nSrv.getTranslation("facebook_status_post_description")};return e},a.prototype.formatEntryFeed=function(a){var b="",c="",d="",e="";b=civ.i18nSrv.getTranslation("facebook_timeline_post"),b=lib.sprintf(b,a.placeName,a.placeCity),a.entryTitle!==""?c='"'+a.entryTitle+" - "+a.entryText+'"':c='"'+a.entryText+'"',d=civ.i18nSrv.getTranslation("facebook_timeline_description"),d=lib.sprintf(d,a.entryVoteUp,a.entryVoteDown),e=civ.i18nSrv.getTranslation("facebook_timeline_stats"),e=lib.sprintf(e,a.placeRatingsCount,a.placeRatingsBestCons);var f={picture:a.placeLogo,link:civ.civilizWebsite,name:b+" "+c+" "+d+" "+e,caption:civ.civilizWebsiteCaption,description:civ.i18nSrv.getTranslation("facebook_status_post_description")};return console.log(f.name),f},a}),define("utils/Tools",[],function(){var a={};return a.alert=function(a,b,c,d){b||(b=function(){});try{navigator.notification.alert(a,b,c,d)}catch(e){alert(a),b&&b()}},a.confirm=function(a,b,c,d){b||(b={}),b.left||(b.left=function(){}),b.right||(b.right=function(){});try{var e=d.left+","+d.right,f=function(a){a===1?b.left():b.right()};navigator.notification.confirm(a,f,c,e)}catch(g){var h=confirm(a);h?b.right():b.left()}},a}),define("app",["domReady","routers/application_router","utils/FacebookHandler","models/user","utils/Tools"],function(a,b,c,d,e){function j(a){if(f&&a.webapp||f&&g){$.initialize(),hckApp.router=new b;try{var d={appId:"207544032598461",nativeInterface:CDV.FB,useCachedDialogs:!1,cookie:!0};FB.init(d)}catch(e){console.log(e)}return hckApp.fbHdl=new c,a.geolocate&&m(),Backbone.history.start()}return!1}function k(a){hckApp.user&&(hckApp.user.set("lat",a.coords.latitude),hckApp.user.set("lng",a.coords.longitude))}function l(a){console.log("erreur geoloc")}function m(){h=navigator.geolocation.watchPosition(k,l,{maximumAge:1e4,timeout:15e3,enableHighAccuracy:!0})}window.hckApp=window.hckApp||{},hckApp.user=new d({usermMail:"valentin@civiliz.fr"}),hckApp.Tools=e;var f=!1,g=!1,h=null,i=function(b){hckApp.config=b,a(function(){f=!0,j(b)}),document.addEventListener("deviceready",function(){g=!0,j(b)},!1)};return{initialize:i}}),define("config",[],function(){return{webapp:!0,geolocate:!1}}),function(){(function(a){function e(){var b;return b=a("body").children(),b.first().remove(),b.last().css({left:"0%","-webkit-transform":"none"})}function f(b){var d;return d=c,d-=_.reduce(b.find(".toolbar"),function(b,c){return b+=a(c).height()},0),b.find(".wrapper").css("height",d+"px")}var b,c,d;a.initialize=function(){return b=null,c=window.innerHeight||460,d=.8,document.body.addEventListener("touchmove",function(a){return a.preventDefault()}),a("body").css({"-webkit-perspective-origin":"50% "+c/2+"px"})},a.insertContent=function(b,c){var d;return c==null&&(c={direction:1}),d=a("body > div:first-child"),a("body").append(b.css({left:"-100%"})),a.setupIScroll(b),d.length===0?b.css({left:"0"}):(d.anim({translateX:""+ -c.direction+"00%"},.25,"ease-out",e),b.css({left:""+c.direction+"00%"}).anim({translateX:""+ -c.direction+"00%"},.25,"ease-out"))},a.flip=function(b){var c,e;return a("body").append(b),e=a("body > div:first-child"),c=a("body > div:last-child"),a.setupIScroll(c),c.height(e.height()+"px").width(e.width()+"px"),a("body > div").addClass("flip"),c.css({opacity:0}),c.anim({rotateY:"-90deg",scale:d},.4,"ease-in",function(){return c.anim({rotateY:"0deg",scale:1,opacity:1},.4,"ease-out")}),e.anim({rotateY:"90deg",scale:d,opacity:0},.4,"ease-in",function(){return e.anim({rotateY:"180deg",scale:1},.4,"ease-out")})},a.flipBack=function(){var b,c;return b=a("body > div:first-child"),c=a("body > div:last-child"),a("body > div").removeClass("flip"),c.anim({rotateY:"-90deg",scale:d,opacity:0},.4,"ease-in",function(){return c.remove()}),b.anim({rotateY:"90deg",scale:d},.4,"ease-in",function(){return b.css({opacity:0}),b.anim({rotateY:"0deg",scale:1,opacity:1},.4,"ease-out")}),a.setupIScroll(b)},a.setupIScroll=function(c){var d;c==null&&(c=null);if(typeof iScroll=="undefined")return;b&&(b.destroy(),b=null),c==null&&(c=a("body > div:first-child")),d=c.find(".wrapper")[0];if(d)return setTimeout(function(){f(c),b=new iScroll(d)},0),b},a.refreshScroll=function(){setTimeout(function(){b?b.refresh():a.refreshScroll()},10)},a.hexColorFromString=function(a,b){var c;return b==null&&(b=""),a.slice(0,4)==="rgb("?(c=a.slice(4,a.length-1).split(","),_.inject(c,function(a,b){return b=parseInt(b,10).toString(16),b.length===1&&(b="0"+b),a+=b},b)):a}})(Zepto)}.call(this),define("utils/iphone",function(){}),window.google=window.google||{},window.google.ui=window.google.ui||{},google.ui.FastButton=function(a,b){this.element=a,this.handler=b,a.addEventListener("touchstart",this,!1),a.addEventListener("click",this,!1)},google.ui.FastButton.prototype.handleEvent=function(a){switch(a.type){case"touchstart":$(this.element).addClass("active"),this.onTouchStart(a);break;case"touchmove":this.onTouchMove(a);break;case"touchend":$(this.element).removeClass("active"),this.onClick(a);break;case"click":$(this.element).addClass("active"),setTimeout(function(){$(this.element).removeClass("active")},100),this.onClick(a)}},google.ui.FastButton.prototype.onTouchStart=function(a){a.stopPropagation(),this.element.addEventListener("touchend",this,!1),document.body.addEventListener("touchmove",this,!1),this.startX=a.touches[0].clientX,this.startY=a.touches[0].clientY},google.ui.FastButton.prototype.onTouchMove=function(a){(Math.abs(a.touches[0].clientX-this.startX)>10||Math.abs(a.touches[0].clientY-this.startY)>10)&&this.reset()},google.ui.FastButton.prototype.onClick=function(a){a.stopPropagation(),this.reset(),this.handler(a),a.type=="touchend"&&google.clickbuster.preventGhostClick(this.startX,this.startY)},google.ui.FastButton.prototype.reset=function(){$(this.element).removeClass("active"),this.element.removeEventListener("touchend",this,!1),document.body.removeEventListener("touchmove",this,!1)},google.clickbuster={},google.clickbuster.preventGhostClick=function(a,b){google.clickbuster.coordinates.push(a,b),window.setTimeout(google.clickbuster.pop,2500)},google.clickbuster.pop=function(){google.clickbuster.coordinates.splice(0,2)},google.clickbuster.onClick=function(a){for(var b=0;b<google.clickbuster.coordinates.length;b+=2){var c=google.clickbuster.coordinates[b],d=google.clickbuster.coordinates[b+1];Math.abs(a.clientX-c)<25&&Math.abs(a.clientY-d)<25&&(a.stopPropagation(),a.preventDefault())}},document.addEventListener("click",google.clickbuster.onClick,!0),google.clickbuster.coordinates=[],window.ActiveButton=function(a){this.element=a,this.startX=0,this.startY=0,this.hasMoved=!1,this.touchHasFinished=!1,this.isActivated=!1,this.element.addEventListener("touchstart",this,!1),this.element.addEventListener("touchend",this,!1),this.element.addEventListener("touchmove",this,!1)},window.ActiveButton.prototype.handleEvent=function(a){switch(a.type){case"touchstart":this.onTouchStart(a);break;case"touchmove":this.onTouchMove(a);break;case"touchend":this.onTouchEnd(a)}},window.ActiveButton.prototype.onTouchStart=function(a){this.startX=a.touches[0].clientX,this.startY=a.touches[0].clientY,this.touchHasFinished=!1,this.isActivated=!1,this.hasMoved=!1;var b=this;setTimeout(function(){!b.hasMoved&&!b.touchHasFinished&&($(b.element).addClass("active"),b.isActivated=!0)},200)},window.ActiveButton.prototype.onTouchMove=function(a){if(Math.abs(a.touches[0].clientX-this.startX)>10||Math.abs(a.touches[0].clientY-this.startY)>10||this.hasMoved)this.hasMoved=!0;(Math.abs(a.touches[0].clientX-this.startX)>1||Math.abs(a.touches[0].clientY-this.startY)>1)&&this.isActivated&&$(this.element).removeClass("active")},window.ActiveButton.prototype.onTouchEnd=function(a){this.touchHasFinished=!0,$(this.element).removeClass("active")},define("utils/fast_button",function(){}),function(){var a=Math,b=function(a){return a>>0},c=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"Moz":/trident/i.test(navigator.userAgent)?"ms":"opera"in window?"O":"",d=/android/gi.test(navigator.appVersion),e=/iphone|ipad/gi.test(navigator.appVersion),f=/playbook/gi.test(navigator.appVersion),g=/hp-tablet/gi.test(navigator.appVersion),h="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,i="ontouchstart"in window&&!g,j=c+"Transform"in document.documentElement.style,k=e||f,l=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,1)}}(),m=function(){return window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}(),n="onorientationchange"in window?"orientationchange":"resize",o=i?"touchstart":"mousedown",p=i?"touchmove":"mousemove",q=i?"touchend":"mouseup",r=i?"touchcancel":"mouseup",s=c=="Moz"?"DOMMouseScroll":"mousewheel",t="translate"+(h?"3d(":"("),u=h?",0)":")",v=function(a,b){var f=this,g=document,l;f.wrapper=typeof a=="object"?a:g.getElementById(a),f.wrapper.style.overflow="hidden",f.scroller=f.wrapper.children[0],f.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:d,hideScrollbar:e,fadeScrollbar:e&&h,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(a){a.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(l in b)f.options[l]=b[l];f.x=f.options.x,f.y=f.options.y,f.options.useTransform=j?f.options.useTransform:!1,f.options.hScrollbar=f.options.hScroll&&f.options.hScrollbar,f.options.vScrollbar=f.options.vScroll&&f.options.vScrollbar,f.options.zoom=f.options.useTransform&&f.options.zoom,f.options.useTransition=k&&f.options.useTransition,f.options.zoom&&d&&(t="translate(",u=")"),f.scroller.style[c+"TransitionProperty"]=f.options.useTransform?"-"+c.toLowerCase()+"-transform":"top left",f.scroller.style[c+"TransitionDuration"]="0",f.scroller.style[c+"TransformOrigin"]="0 0",f.options.useTransition&&(f.scroller.style[c+"TransitionTimingFunction"]="cubic-bezier(0.33,0.66,0.66,1)"),f.options.useTransform?f.scroller.style[c+"Transform"]=t+f.x+"px,"+f.y+"px"+u:f.scroller.style.cssText+=";position:absolute;top:"+f.y+"px;left:"+f.x+"px",f.options.useTransition&&(f.options.fixedScrollbar=!0),f.refresh(),f._bind(n,window),f._bind(o),i||(f._bind("mouseout",f.wrapper),f.options.wheelAction!="none"&&f._bind(s)),f.options.checkDOMChanges&&(f.checkDOMTime=setInterval(function(){f._checkDOMChanges()},500))};v.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(a){var b=this;switch(a.type){case o:if(!i&&a.button!==0)return;b._start(a);break;case p:b._move(a);break;case q:case r:b._end(a);break;case n:b._resize();break;case s:b._wheel(a);break;case"mouseout":b._mouseout(a);break;case"webkitTransitionEnd":b._transitionEnd(a)}},_checkDOMChanges:function(){if(this.moved||this.zoomed||this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale)return;this.refresh()},_scrollbar:function(d){var e=this,f=document,g;if(!e[d+"Scrollbar"]){e[d+"ScrollbarWrapper"]&&(j&&(e[d+"ScrollbarIndicator"].style[c+"Transform"]=""),e[d+"ScrollbarWrapper"].parentNode.removeChild(e[d+"ScrollbarWrapper"]),e[d+"ScrollbarWrapper"]=null,e[d+"ScrollbarIndicator"]=null);return}e[d+"ScrollbarWrapper"]||(g=f.createElement("div"),e.options.scrollbarClass?g.className=e.options.scrollbarClass+d.toUpperCase():g.style.cssText="position:absolute;z-index:100;"+(d=="h"?"height:7px;bottom:1px;left:2px;right:"+(e.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(e.hScrollbar?"7":"2")+"px;top:2px;right:1px"),g.style.cssText+=";pointer-events:none;-"+c+"-transition-property:opacity;-"+c+"-transition-duration:"+(e.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(e.options.hideScrollbar?"0":"1"),e.wrapper.appendChild(g),e[d+"ScrollbarWrapper"]=g,g=f.createElement("div"),e.options.scrollbarClass||(g.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);-"+c+"-background-clip:padding-box;-"+c+"-box-sizing:border-box;"+(d=="h"?"height:100%":"width:100%")+";-"+c+"-border-radius:3px;border-radius:3px"),g.style.cssText+=";pointer-events:none;-"+c+"-transition-property:-"+c+"-transform;-"+c+"-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);-"+c+"-transition-duration:0;-"+c+"-transform:"+t+"0,0"+u,e.options.useTransition&&(g.style.cssText+=";-"+c+"-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"),e[d+"ScrollbarWrapper"].appendChild(g),e[d+"ScrollbarIndicator"]=g),d=="h"?(e.hScrollbarSize=e.hScrollbarWrapper.clientWidth,e.hScrollbarIndicatorSize=a.max(b(e.hScrollbarSize*e.hScrollbarSize/e.scrollerW),8),e.hScrollbarIndicator.style.width=e.hScrollbarIndicatorSize+"px",e.hScrollbarMaxScroll=e.hScrollbarSize-e.hScrollbarIndicatorSize,e.hScrollbarProp=e.hScrollbarMaxScroll/e.maxScrollX):(e.vScrollbarSize=e.vScrollbarWrapper.clientHeight,e.vScrollbarIndicatorSize=a.max(b(e.vScrollbarSize*e.vScrollbarSize/e.scrollerH),8),e.vScrollbarIndicator.style.height=e.vScrollbarIndicatorSize+"px",e.vScrollbarMaxScroll=e.vScrollbarSize-e.vScrollbarIndicatorSize,e.vScrollbarProp=e.vScrollbarMaxScroll/e.maxScrollY),e._scrollbarPos(d,!0)},_resize:function(){var a=this;setTimeout(function(){a.refresh()},d?200:0)},_pos:function(a,d){if(this.zoomed)return;a=this.hScroll?a:0,d=this.vScroll?d:0,this.options.useTransform?this.scroller.style[c+"Transform"]=t+a+"px,"+d+"px"+u+" scale("+this.scale+")":(a=b(a),d=b(d),this.scroller.style.left=a+"px",this.scroller.style.top=d+"px"),this.x=a,this.y=d,this._scrollbarPos("h"),this._scrollbarPos("v")},_scrollbarPos:function(a,d){var e=this,f=a=="h"?e.x:e.y,g;if(!e[a+"Scrollbar"])return;f=e[a+"ScrollbarProp"]*f,f<0?(e.options.fixedScrollbar||(g=e[a+"ScrollbarIndicatorSize"]+b(f*3),g<8&&(g=8),e[a+"ScrollbarIndicator"].style[a=="h"?"width":"height"]=g+"px"),f=0):f>e[a+"ScrollbarMaxScroll"]&&(e.options.fixedScrollbar?f=e[a+"ScrollbarMaxScroll"]:(g=e[a+"ScrollbarIndicatorSize"]-b((f-e[a+"ScrollbarMaxScroll"])*3),g<8&&(g=8),e[a+"ScrollbarIndicator"].style[a=="h"?"width":"height"]=g+"px",f=e[a+"ScrollbarMaxScroll"]+(e[a+"ScrollbarIndicatorSize"]-g))),e[a+"ScrollbarWrapper"].style[c+"TransitionDelay"]="0",e[a+"ScrollbarWrapper"].style.opacity=d&&e.options.hideScrollbar?"0":"1",e[a+"ScrollbarIndicator"].style[c+"Transform"]=t+(a=="h"?f+"px,0":"0,"+f+"px")+u},_start:function(b){var d=this,e=i?b.touches[0]:b,f,g,h,j,k;if(!d.enabled)return;d.options.onBeforeScrollStart&&d.options.onBeforeScrollStart.call(d,b),(d.options.useTransition||d.options.zoom)&&d._transitionTime(0),d.moved=!1,d.animating=!1,d.zoomed=!1,d.distX=0,d.distY=0,d.absDistX=0,d.absDistY=0,d.dirX=0,d.dirY=0,d.options.zoom&&i&&b.touches.length>1&&(j=a.abs(b.touches[0].pageX-b.touches[1].pageX),k=a.abs(b.touches[0].pageY-b.touches[1].pageY),d.touchesDistStart=a.sqrt(j*j+k*k),d.originX=a.abs(b.touches[0].pageX+b.touches[1].pageX-d.wrapperOffsetLeft*2)/2-d.x,d.originY=a.abs(b.touches[0].pageY+b.touches[1].pageY-d.wrapperOffsetTop*2)/2-d.y,d.options.onZoomStart&&d.options.onZoomStart.call(d,b));if(d.options.momentum){d.options.useTransform?(f=getComputedStyle(d.scroller,null)[c+"Transform"].replace(/[^0-9-.,]/g,"").split(","),g=f[4]*1,h=f[5]*1):(g=getComputedStyle(d.scroller,null).left.replace(/[^0-9-]/g,"")*1,h=getComputedStyle(d.scroller,null).top.replace(/[^0-9-]/g,"")*1);if(g!=d.x||h!=d.y)d.options.useTransition?d._unbind("webkitTransitionEnd"):m(d.aniTime),d.steps=[],d._pos(g,h)}d.absStartX=d.x,d.absStartY=d.y,d.startX=d.x,d.startY=d.y,d.pointX=e.pageX,d.pointY=e.pageY,d.startTime=b.timeStamp||Date.now(),d.options.onScrollStart&&d.options.onScrollStart.call(d,b),d._bind(p),d._bind(q),d._bind(r)},_move:function(b){var d=this,e=i?b.touches[0]:b,f=e.pageX-d.pointX,g=e.pageY-d.pointY,h=d.x+f,j=d.y+g,k,l,m,n=b.timeStamp||Date.now();d.options.onBeforeScrollMove&&d.options.onBeforeScrollMove.call(d,b);if(d.options.zoom&&i&&b.touches.length>1){k=a.abs(b.touches[0].pageX-b.touches[1].pageX),l=a.abs(b.touches[0].pageY-b.touches[1].pageY),d.touchesDist=a.sqrt(k*k+l*l),d.zoomed=!0,m=1/d.touchesDistStart*d.touchesDist*this.scale,m<d.options.zoomMin?m=.5*d.options.zoomMin*Math.pow(2,m/d.options.zoomMin):m>d.options.zoomMax&&(m=2*d.options.zoomMax*Math.pow(.5,d.options.zoomMax/m)),d.lastScale=m/this.scale,h=this.originX-this.originX*d.lastScale+this.x,j=this.originY-this.originY*d.lastScale+this.y,this.scroller.style[c+"Transform"]=t+h+"px,"+j+"px"+u+" scale("+m+")",d.options.onZoom&&d.options.onZoom.call(d,b);return}d.pointX=e.pageX,d.pointY=e.pageY;if(h>0||h<d.maxScrollX)h=d.options.bounce?d.x+f/2:h>=0||d.maxScrollX>=0?0:d.maxScrollX;if(j>d.minScrollY||j<d.maxScrollY)j=d.options.bounce?d.y+g/2:j>=d.minScrollY||d.maxScrollY>=0?d.minScrollY:d.maxScrollY;d.distX+=f,d.distY+=g,d.absDistX=a.abs(d.distX),d.absDistY=a.abs(d.distY);if(d.absDistX<6&&d.absDistY<6)return;d.options.lockDirection&&(d.absDistX>d.absDistY+5?(j=d.y,g=0):d.absDistY>d.absDistX+5&&(h=d.x,f=0)),d.moved=!0,d._pos(h,j),d.dirX=f>0?-1:f<0?1:0,d.dirY=g>0?-1:g<0?1:0,n-d.startTime>300&&(d.startTime=n,d.startX=d.x,d.startY=d.y),d.options.onScrollMove&&d.options.onScrollMove.call(d,b)},_end:function(d){if(i&&d.touches.length!=0)return;var e=this,f=i?d.changedTouches[0]:d,g,h,j={dist:0,time:0},k={dist:0,time:0},l=(d.timeStamp||Date.now())-e.startTime,m=e.x,n=e.y,o,s,v,w,x;e._unbind(p),e._unbind(q),e._unbind(r),e.options.onBeforeScrollEnd&&e.options.onBeforeScrollEnd.call(e,d);if(e.zoomed){x=e.scale*e.lastScale,x=Math.max(e.options.zoomMin,x),x=Math.min(e.options.zoomMax,x),e.lastScale=x/e.scale,e.scale=x,e.x=e.originX-e.originX*e.lastScale+e.x,e.y=e.originY-e.originY*e.lastScale+e.y,e.scroller.style[c+"TransitionDuration"]="200ms",e.scroller.style[c+"Transform"]=t+e.x+"px,"+e.y+"px"+u+" scale("+e.scale+")",e.zoomed=!1,e.refresh(),e.options.onZoomEnd&&e.options.onZoomEnd.call(e,d);return}if(!e.moved){i&&(e.doubleTapTimer&&e.options.zoom?(clearTimeout(e.doubleTapTimer),e.doubleTapTimer=null,e.options.onZoomStart&&e.options.onZoomStart.call(e,d),e.zoom(e.pointX,e.pointY,e.scale==1?e.options.doubleTapZoom:1),e.options.onZoomEnd&&setTimeout(function(){e.options.onZoomEnd.call(e,d)},200)):e.doubleTapTimer=setTimeout(function(){e.doubleTapTimer=null,g=f.target;while(g.nodeType!=1)g=g.parentNode;g.tagName!="SELECT"&&g.tagName!="INPUT"&&g.tagName!="TEXTAREA"&&(h=document.createEvent("MouseEvents"),h.initMouseEvent("click",!0,!0,d.view,1,f.screenX,f.screenY,f.clientX,f.clientY,d.ctrlKey,d.altKey,d.shiftKey,d.metaKey,0,null),h._fake=!0,g.dispatchEvent(h))},e.options.zoom?250:0)),e._resetPos(200),e.options.onTouchEnd&&e.options.onTouchEnd.call(e,d);return}if(l<300&&e.options.momentum){j=m?e._momentum(m-e.startX,l,-e.x,e.scrollerW-e.wrapperW+e.x,e.options.bounce?e.wrapperW:0):j,k=n?e._momentum(n-e.startY,l,-e.y,e.maxScrollY<0?e.scrollerH-e.wrapperH+e.y-e.minScrollY:0,e.options.bounce?e.wrapperH:0):k,m=e.x+j.dist,n=e.y+k.dist;if(e.x>0&&m>0||e.x<e.maxScrollX&&m<e.maxScrollX)j={dist:0,time:0};if(e.y>e.minScrollY&&n>e.minScrollY||e.y<e.maxScrollY&&n<e.maxScrollY)k={dist:0,time:0}}if(j.dist||k.dist){v=a.max(a.max(j.time,k.time),10),e.options.snap&&(o=m-e.absStartX,s=n-e.absStartY,a.abs(o)<e.options.snapThreshold&&a.abs(s)<e.options.snapThreshold?e.scrollTo(e.absStartX,e.absStartY,200):(w=e._snap(m,n),m=w.x,n=w.y,v=a.max(w.time,v))),e.scrollTo(b(m),b(n),v),e.options.onTouchEnd&&e.options.onTouchEnd.call(e,d);return}if(e.options.snap){o=m-e.absStartX,s=n-e.absStartY,a.abs(o)<e.options.snapThreshold&&a.abs(s)<e.options.snapThreshold?e.scrollTo(e.absStartX,e.absStartY,200):(w=e._snap(e.x,e.y),(w.x!=e.x||w.y!=e.y)&&e.scrollTo(w.x,w.y,w.time)),e.options.onTouchEnd&&e.options.onTouchEnd.call(e,d);return}e._resetPos(200),e.options.onTouchEnd&&e.options.onTouchEnd.call(e,d)},_resetPos:function(a){var b=this,d=b.x>=0?0:b.x<b.maxScrollX?b.maxScrollX:b.x,e=b.y>=b.minScrollY||b.maxScrollY>0?b.minScrollY:b.y<b.maxScrollY?b.maxScrollY:b.y;if(d==b.x&&e==b.y){b.moved&&(b.moved=!1,b.options.onScrollEnd&&b.options.onScrollEnd.call(b)),b.hScrollbar&&b.options.hideScrollbar&&(c=="webkit"&&(b.hScrollbarWrapper.style[c+"TransitionDelay"]="300ms"),b.hScrollbarWrapper.style.opacity="0"),b.vScrollbar&&b.options.hideScrollbar&&(c=="webkit"&&(b.vScrollbarWrapper.style[c+"TransitionDelay"]="300ms"),b.vScrollbarWrapper.style.opacity="0");return}b.scrollTo(d,e,a||0)},_wheel:function(a){var b=this,c,d,e,f,g;if("wheelDeltaX"in a)c=a.wheelDeltaX/12,d=a.wheelDeltaY/12;else if("wheelDelta"in a)c=d=a.wheelDelta/12;else{if(!("detail"in a))return;c=d=-a.detail*3}if(b.options.wheelAction=="zoom"){g=b.scale*Math.pow(2,1/3*(d?d/Math.abs(d):0)),g<b.options.zoomMin&&(g=b.options.zoomMin),g>b.options.zoomMax&&(g=b.options.zoomMax),g!=b.scale&&(!b.wheelZoomCount&&b.options.onZoomStart&&b.options.onZoomStart.call(b,a),b.wheelZoomCount++,b.zoom(a.pageX,a.pageY,g,400),setTimeout(function(){b.wheelZoomCount--,!b.wheelZoomCount&&b.options.onZoomEnd&&b.options.onZoomEnd.call(b,a)},400));return}e=b.x+c,f=b.y+d,e>0?e=0:e<b.maxScrollX&&(e=b.maxScrollX),f>b.minScrollY?f=b.minScrollY:f<b.maxScrollY&&(f=b.maxScrollY),b.maxScrollY<0&&b.scrollTo(e,f,0)},_mouseout:function(a){var b=a.relatedTarget;if(!b){this._end(a);return}while(b=b.parentNode)if(b==this.wrapper)return;this._end(a)},_transitionEnd:function(a){var b=this;if(a.target!=b.scroller)return;b._unbind("webkitTransitionEnd"),b._startAni()},_startAni:function(){var b=this,c=b.x,d=b.y,e=Date.now(),f,g,h;if(b.animating)return;if(!b.steps.length){b._resetPos(400);return}f=b.steps.shift(),f.x==c&&f.y==d&&(f.time=0),b.animating=!0,b.moved=!0;if(b.options.useTransition){b._transitionTime(f.time),b._pos(f.x,f.y),b.animating=!1,f.time?b._bind("webkitTransitionEnd"):b._resetPos(0);return}h=function(){var i=Date.now(),j,k;if(i>=e+f.time){b._pos(f.x,f.y),b.animating=!1,b.options.onAnimationEnd&&b.options.onAnimationEnd.call(b),b._startAni();return}i=(i-e)/f.time-1,g=a.sqrt(1-i*i),j=(f.x-c)*g+c,k=(f.y-d)*g+d,b._pos(j,k),b.animating&&(b.aniTime=l(h))},h()},_transitionTime:function(a){a+="ms",this.scroller.style[c+"TransitionDuration"]=a,this.hScrollbar&&(this.hScrollbarIndicator.style[c+"TransitionDuration"]=a),this.vScrollbar&&(this.vScrollbarIndicator.style[c+"TransitionDuration"]=a)},_momentum:function(c,d,e,f,g){var h=6e-4,i=a.abs(c)/d,j=i*i/(2*h),k=0,l=0;return c>0&&j>e?(l=g/(6/(j/i*h)),e+=l,i=i*e/j,j=e):c<0&&j>f&&(l=g/(6/(j/i*h)),f+=l,i=i*f/j,j=f),j*=c<0?-1:1,k=i/h,{dist:j,time:b(k)}},_offset:function(a){var b=-a.offsetLeft,c=-a.offsetTop;while(a=a.offsetParent)b-=a.offsetLeft,c-=a.offsetTop;return a!=this.wrapper&&(b*=this.scale,c*=this.scale),{left:b,top:c}},_snap:function(c,d){var e=this,f,g,h,i,j,k;h=e.pagesX.length-1;for(f=0,g=e.pagesX.length;f<g;f++)if(c>=e.pagesX[f]){h=f;break}h==e.currPageX&&h>0&&e.dirX<0&&h--,c=e.pagesX[h],j=a.abs(c-e.pagesX[e.currPageX]),j=j?a.abs(e.x-c)/j*500:0,e.currPageX=h,h=e.pagesY.length-1;for(f=0;f<h;f++)if(d>=e.pagesY[f]){h=f;break}return h==e.currPageY&&h>0&&e.dirY<0&&h--,d=e.pagesY[h],k=a.abs(d-e.pagesY[e.currPageY]),k=k?a.abs(e.y-d)/k*500:0,e.currPageY=h,i=b(a.max(j,k))||200,{x:c,y:d,time:i}},_bind:function(a,b,c){(b||this.scroller).addEventListener(a,this,!!c)},_unbind:function(a,b,c){(b||this.scroller).removeEventListener(a,this,!!c)},destroy:function(){var a=this;a.scroller.style[c+"Transform"]="",a.hScrollbar=!1,a.vScrollbar=!1,a._scrollbar("h"),a._scrollbar("v"),a._unbind(n,window),a._unbind(o),a._unbind(p),a._unbind(q),a._unbind(r),a.options.hasTouch||(a._unbind("mouseout",a.wrapper),a._unbind(s)),a.options.useTransition&&a._unbind("webkitTransitionEnd"),a.options.checkDOMChanges&&clearInterval(a.checkDOMTime),a.options.onDestroy&&a.options.onDestroy.call(a)},refresh:function(){var a=this,d,e,f,g,h=0,i=0;a.scale<a.options.zoomMin&&(a.scale=a.options.zoomMin),a.wrapperW=a.wrapper.clientWidth||1,a.wrapperH=a.wrapper.clientHeight||1,a.minScrollY=-a.options.topOffset||0,a.scrollerW=b(a.scroller.offsetWidth*a.scale),a.scrollerH=b((a.scroller.offsetHeight+a.minScrollY)*a.scale),a.maxScrollX=a.wrapperW-a.scrollerW,a.maxScrollY=a.wrapperH-a.scrollerH+a.minScrollY,a.dirX=0,a.dirY=0,a.options.onRefresh&&a.options.onRefresh.call(a),a.hScroll=a.options.hScroll&&a.maxScrollX<0,a.vScroll=a.options.vScroll&&(!a.options.bounceLock&&!a.hScroll||a.scrollerH>a.wrapperH),a.hScrollbar=a.hScroll&&a.options.hScrollbar,a.vScrollbar=a.vScroll&&a.options.vScrollbar&&a.scrollerH>a.wrapperH,d=a._offset(a.wrapper),a.wrapperOffsetLeft=-d.left,a.wrapperOffsetTop=-d.top;if(typeof a.options.snap=="string"){a.pagesX=[],a.pagesY=[],g=a.scroller.querySelectorAll(a.options.snap);for(e=0,f=g.length;e<f;e++)h=a._offset(g[e]),h.left+=a.wrapperOffsetLeft,h.top+=a.wrapperOffsetTop,a.pagesX[e]=h.left<a.maxScrollX?a.maxScrollX:h.left*a.scale,a.pagesY[e]=h.top<a.maxScrollY?a.maxScrollY:h.top*a.scale}else if(a.options.snap){a.pagesX=[];while(h>=a.maxScrollX)a.pagesX[i]=h,h-=a.wrapperW,i++;a.maxScrollX%a.wrapperW&&(a.pagesX[a.pagesX.length]=a.maxScrollX-a.pagesX[a.pagesX.length-1]+a.pagesX[a.pagesX.length-1]),h=0,i=0,a.pagesY=[];while(h>=a.maxScrollY)a.pagesY[i]=h,h-=a.wrapperH,i++;a.maxScrollY%a.wrapperH&&(a.pagesY[a.pagesY.length]=a.maxScrollY-a.pagesY[a.pagesY.length-1]+a.pagesY[a.pagesY.length-1])}a._scrollbar("h"),a._scrollbar("v"),a.zoomed||(a.scroller.style[c+"TransitionDuration"]="0",a._resetPos(200))},scrollTo:function(a,b,c,d){var e=this,f=a,g,h;e.stop(),f.length||(f=[{x:a,y:b,time:c,relative:d}]);for(g=0,h=f.length;g<h;g++)f[g].relative&&(f[g].x=e.x-f[g].x,f[g].y=e.y-f[g].y),e.steps.push({x:f[g].x,y:f[g].y,time:f[g].time||0});e._startAni()},scrollToElement:function(b,c){var d=this,e;b=b.nodeType?b:d.scroller.querySelector(b);if(!b)return;e=d._offset(b),e.left+=d.wrapperOffsetLeft,e.top+=d.wrapperOffsetTop,e.left=e.left>0?0:e.left<d.maxScrollX?d.maxScrollX:e.left,e.top=e.top>d.minScrollY?d.minScrollY:e.top<d.maxScrollY?d.maxScrollY:e.top,c=c===undefined?a.max(a.abs(e.left)*2,a.abs(e.top)*2):c,d.scrollTo(e.left,e.top,c)},scrollToPage:function(a,b,c){var d=this,e,f;c=c===undefined?400:c,d.options.onScrollStart&&d.options.onScrollStart.call(d),d.options.snap?(a=a=="next"?d.currPageX+1:a=="prev"?d.currPageX-1:a,b=b=="next"?d.currPageY+1:b=="prev"?d.currPageY-1:b,a=a<0?0:a>d.pagesX.length-1?d.pagesX.length-1:a,b=b<0?0:b>d.pagesY.length-1?d.pagesY.length-1:b,d.currPageX=a,d.currPageY=b,e=d.pagesX[a],f=d.pagesY[b]):(e=-d.wrapperW*a,f=-d.wrapperH*b,e<d.maxScrollX&&(e=d.maxScrollX),f<d.maxScrollY&&(f=d.maxScrollY)),d.scrollTo(e,f,c)},disable:function(){this.stop(),this._resetPos(0),this.enabled=!1,this._unbind(p),this._unbind(q),this._unbind(r)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind("webkitTransitionEnd"):m(this.aniTime),this.steps=[],this.moved=!1,this.animating=!1},zoom:function(a,b,d,e){var f=this,g=d/f.scale;if(!f.options.useTransform)return;f.zoomed=!0,e=e===undefined?200:e,a=a-f.wrapperOffsetLeft-f.x,b=b-f.wrapperOffsetTop-f.y,f.x=a-a*g+f.x,f.y=b-b*g+f.y,f.scale=d,f.refresh(),f.x=f.x>0?0:f.x<f.maxScrollX?f.maxScrollX:f.x,f.y=f.y>f.minScrollY?f.minScrollY:f.y<f.maxScrollY?f.maxScrollY:f.y,f.scroller.style[c+"TransitionDuration"]=e+"ms",f.scroller.style[c+"Transform"]=t+f.x+"px,"+f.y+"px"+u+" scale("+d+")",f.zoomed=!1},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}},typeof exports!="undefined"?exports.iScroll=v:window.iScroll=v}(),define("../js/iscroll",function(){});var Mustache=typeof module!="undefined"&&module.exports||{};(function(a){function i(a){return h.test(a)}function n(a){return String(a).replace(/&(?!\w+;)|[<>"']/g,function(a){return m[a]||a})}function o(a,b,c,d){d=d||"<template>";var e=b.split("\n"),f=Math.max(c-3,0),g=Math.min(e.length,c+3),h=e.slice(f,g),i;for(var j=0,k=h.length;j<k;++j)i=j+f+1,h[j]=(i===c?" >> ":"    ")+h[j];return a.template=b,a.line=c,a.file=d,a.message=[d+":"+c,h.join("\n"),"",a.message].join("\n"),a}function p(a,b,c){if(a===".")return b[b.length-1];var d=a.split("."),e=d.length-1,f=d[e],g,h,i=b.length,j,k;while(i){k=b.slice(0),h=b[--i],j=0;while(j<e){h=h[d[j++]];if(h==null)break;k.push(h)}if(h&&typeof h=="object"&&f in h){g=h[f];break}}return typeof g=="function"&&(g=g.call(k[k.length-1])),g==null?c:g}function q(a,b,c,d){var e="",h=p(a,b);if(d){if(h==null||h===!1||f(h)&&h.length===0)e+=c()}else if(f(h))g(h,function(a){b.push(a),e+=c(),b.pop()});else if(typeof h=="object")b.push(h),e+=c(),b.pop();else if(typeof h=="function"){var i=b[b.length-1],j=function(a){return w(a,i)};e+=h.call(i,c(),j)||""}else h&&(e+=c());return e}function r(b,c){c=c||{};var d=c.tags||a.tags,e=d[0],f=d[d.length-1],g=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'],h=[],k=!1,l=!1,m=function(){if(k&&!l&&!c.space)while(h.length)g.splice(h.pop(),1);else h=[];k=!1,l=!1},n=[],p,q,r,s=function(a){d=j(a).split(/\s+/),q=d[0],r=d[d.length-1]},t=function(a){g.push('";',p,'\nvar partial = partials["'+j(a)+'"];',"\nif (partial) {","\n  buffer += render(partial,stack[stack.length - 1],partials);","\n}",'\nbuffer += "')},u=function(a,d){var e=j(a);if(e==="")throw o(new Error("Section name may not be empty"),b,z,c.file);n.push({name:e,inverted:d}),g.push('";',p,'\nvar name = "'+e+'";',"\nvar callback = (function () {","\n  return function () {",'\n    var buffer = "";','\nbuffer += "')},v=function(a){u(a,!0)},w=function(a){var d=j(a),e=n.length!=0&&n[n.length-1].name;if(!e||d!=e)throw o(new Error('Section named "'+d+'" was never opened'),b,z,c.file);var f=n.pop();g.push('";',"\n    return buffer;","\n  };","\n})();"),f.inverted?g.push("\nbuffer += renderSection(name,stack,callback,true);"):g.push("\nbuffer += renderSection(name,stack,callback);"),g.push('\nbuffer += "')},x=function(a){g.push('";',p,'\nbuffer += lookup("'+j(a)+'",stack,"");','\nbuffer += "')},y=function(a){g.push('";',p,'\nbuffer += escapeHTML(lookup("'+j(a)+'",stack,""));','\nbuffer += "')},z=1,A,B;for(var C=0,D=b.length;C<D;++C)if(b.slice(C,C+e.length)===e){C+=e.length,A=b.substr(C,1),p="\nline = "+z+";",q=e,r=f,k=!0;switch(A){case"!":C++,B=null;break;case"=":C++,f="="+f,B=s;break;case">":C++,B=t;break;case"#":C++,B=u;break;case"^":C++,B=v;break;case"/":C++,B=w;break;case"{":f="}"+f;case"&":C++,l=!0,B=x;break;default:l=!0,B=y}var E=b.indexOf(f,C);if(E===-1)throw o(new Error('Tag "'+e+'" was not closed properly'),b,z,c.file);var F=b.substring(C,E);B&&B(F);var G=0;while(~(G=F.indexOf("\n",G)))z++,G++;C=E+f.length-1,e=q,f=r}else{A=b.substr(C,1);switch(A){case'"':case"\\":l=!0,g.push("\\"+A);break;case"\r":break;case"\n":h.push(g.length),g.push("\\n"),m(),z++;break;default:i(A)?h.push(g.length):l=!0,g.push(A)}}if(n.length!=0)throw o(new Error('Section "'+n[n.length-1].name+'" was not closed properly'),b,z,c.file);m(),g.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");var H=g.join("").replace(/buffer \+= "";\n/g,"");return c.debug&&(typeof console!="undefined"&&console.log?console.log(H):typeof print=="function"&&print(H)),H}function s(a,b){var c="view,partials,stack,lookup,escapeHTML,renderSection,render",d=r(a,b),e=new Function(c,d);return function(c,d){d=d||{};var f=[c];try{return e(c,d,f,p,n,q,w)}catch(g){throw o(g.error,a,g.line,b.file)}}}function u(){t={}}function v(a,b){return b=b||{},b.cache!==!1?(t[a]||(t[a]=s(a,b)),t[a]):s(a,b)}function w(a,b,c){return v(a)(b,c)}a.name="mustache.js",a.version="0.5.0-dev",a.tags=["{{","}}"],a.parse=r,a.compile=v,a.render=w,a.clearCache=u,a.to_html=function(a,b,c,d){var e=w(a,b,c);if(typeof d!="function")return e;d(e)};var b=Object.prototype.toString,c=Array.isArray,d=Array.prototype.forEach,e=String.prototype.trim,f;c?f=c:f=function(a){return b.call(a)==="[object Array]"};var g;d?g=function(a,b,c){return d.call(a,b,c)}:g=function(a,b,c){for(var d=0,e=a.length;d<e;++d)b.call(c,a[d],d,a)};var h=/^\s*$/,j;if(e)j=function(a){return a==null?"":e.call(a)};else{var k,l;i(" ")?(k=/^\s+/,l=/\s+$/):(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),j=function(a){return a==null?"":String(a).replace(k,"").replace(l,"")}}var m={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},t={}})(Mustache),define("../js/mustache",function(){}),require.config({paths:{text:"../js/requirejs/text",domReady:"../js/requirejs/domReady"},baseUrl:"./app"}),require(["app","config","utils/iphone","utils/fast_button","../js/iscroll","../js/mustache"],function(a,b){a.initialize(b)}),define("main",function(){})